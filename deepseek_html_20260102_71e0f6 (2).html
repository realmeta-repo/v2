<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>App Shell – Inteligência & Governança</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Biblioteca de bandeiras -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" />

<style>
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@800;900&family=Merriweather:wght@400&display=swap');

:root {
    --bg-gradient: linear-gradient(120deg,#020617,#042f2e,#020c1b,#020617);
    --animation-duration: 36s;
    --gold-color: #D4AF37; /* Cor dourada */
}

/* ================= RESET ================= */
* { box-sizing: border-box; }
html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: Tahoma, Arial, sans-serif;
    overflow-x: hidden;
}

body {
    display: flex;
    flex-direction: column;
    background: #fff;
    color: #020617;
    min-height: 100vh;
    position: relative;
}

/* ================= ANIMAÇÃO DO GRADIENTE ================= */
.gradient-animated {
    background: var(--bg-gradient);
    background-size: 400% 400%;
    animation: gradientFlow var(--animation-duration) linear infinite;
}

@keyframes gradientFlow {
    from { background-position: 0% 50%; }
    to { background-position: 100% 50%; }
}

/* ================= HEADER / FOOTER ================= */
header, footer {
    background: var(--bg-gradient);
    background-size: 400% 400%;
    animation: gradientFlow var(--animation-duration) linear infinite;
    color: #e5e7eb;
    z-index: 100;
    position: fixed;
    left: 0;
    right: 0;
    transition: all 0.7s cubic-bezier(0.65, 0, 0.35, 1);
    will-change: transform, height;
}

header {
    height: 64px;
    top: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 24px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

footer {
    height: 120px;
    bottom: 0;
    padding: 32px;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
}

.logo {
    font-weight: 800;
    letter-spacing: .12em;
    font-size: .95rem;
    text-transform: uppercase;
    font-family: 'Montserrat', sans-serif;
}

.menu-toggle {
    cursor: pointer;
    display: block;
    font-size: 1.5rem;
    z-index: 101;
}

nav {
    position: fixed;
    top: 64px;
    left: 0;
    right: 0;
    background: var(--bg-gradient);
    background-size: 400% 400%;
    animation: gradientFlow var(--animation-duration) linear infinite;
    display: none;
    flex-direction: column;
    padding: 24px;
    gap: 16px;
    z-index: 99;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

nav.open {
    display: flex;
}

nav a {
    color: #cbd5f5;
    text-decoration: none;
    font-size: .75rem;
    letter-spacing: .14em;
    text-transform: uppercase;
    font-family: 'Montserrat', sans-serif;
    font-weight: 800;
    padding: 8px 0;
    transition: color 0.3s;
    cursor: pointer;
}

nav a:hover {
    color: #fff;
}

/* ================= MAIN CONTENT ================= */
main {
    flex: 1;
    padding: 0px 0 140px;
    position: relative;
    z-index: 1;
}

#app {
    width: 100%;
    overflow: hidden;
    position: relative;
    opacity: 1 !important;
}

/* ================= ESTADO DE PISCADA ================= */
body.blinking header {
    height: 50vh;
    transform: translateY(0);
}

body.blinking footer {
    height: 50vh;
    transform: translateY(0);
}

body.content-hidden #app {
    z-index: 0;
    opacity: 0;
    visibility: hidden;
}

body.content-visible #app {
    z-index: 2;
    opacity: 1;
    visibility: visible;
    transition: opacity 0.3s ease;
}

body.blinking header,
body.blinking footer {
    z-index: 50;
}

body:not(.blinking) header,
body:not(.blinking) footer {
    z-index: 100;
}

/* ================= ESTADO INICIAL - JÁ FECHADO ================= */
body.initial-loading {
    overflow: hidden;
}

body.initial-loading header {
    height: 50vh !important;
    transform: translateY(0) !important;
    transition: none !important;
}

body.initial-loading footer {
    height: 50vh !important;
    transform: translateY(0) !important;
    transition: none !important;
}

body.initial-loading #app {
    opacity: 0 !important;
    visibility: hidden !important;
    transition: none !important;
}

/* ================= ESTADO PÁLPEBRAS PERMANENTEMENTE FECHADAS ================= */
body.eyelids-closed {
    overflow: hidden;
}

body.eyelids-closed header {
    height: 50vh !important;
    transform: translateY(0) !important;
}

body.eyelids-closed footer {
    height: 50vh !important;
    transform: translateY(0) !important;
}

body.eyelids-closed #app {
    opacity: 0 !important;
    visibility: hidden !important;
}

/* ================= CONTACT OVERLAY (EXIBIDO QUANDO AS PÁLPEBRAS ESTÃO FECHADAS) ================= */
.contact-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 150;
    pointer-events: none; /* Permite cliques no header/footer */
}

body.eyelids-closed .contact-overlay {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    pointer-events: none; /* Permite cliques no header/footer */
}

/* Texto maior - o dobro do tamanho atual */
.contact-text {
    color: var(--gold-color);
    font-family: 'Montserrat', sans-serif;
    font-weight: 800;
    letter-spacing: .14em;
    text-transform: uppercase;
    font-size: 1.5rem; /* Dobrado de .75rem para 1.5rem */
    text-align: center;
    margin-bottom: 15px;
    opacity: 0;
    animation: fadeIn 0.5s ease forwards;
    animation-delay: 0.2s; /* REDUZIDO de 0.7s para 0.2s */
    line-height: 1.2;
}

/* Container dos campos de entrada - 10% MENOR */
.contact-fields-container {
    width: 225px; /* REDUZIDO de 250px para 225px (10% menor) */
    max-width: 90vw;
    margin-bottom: 10px;
    opacity: 0;
    animation: fadeIn 0.5s ease forwards;
    animation-delay: 1.0s; /* ADICIONADO delay para aparecer após o título */
    pointer-events: auto; /* Permite interação com o formulário */
}

/* Campo de texto com inner shadow mais pronunciada - SEMPRE VISÍVEL */
.contact-input-container {
    position: relative;
    margin-bottom: 8px;
}

/* Inner shadow mais forte e sempre visível */
.contact-input {
    width: 100%;
    padding: 10px 9px 6px 9px;
    background: white;
    border: 2px solid rgba(212, 175, 55, 0.3);
    border-radius: 8px;
    font-family: 'Montserrat', sans-serif;
    font-size: 13px;
    color: #020617;
    /* Inner shadow mais forte e sempre visível */
    box-shadow: 
        inset 0 2px 4px rgba(0, 0, 0, 0.15),
        inset 0 4px 8px rgba(0, 0, 0, 0.12),
        inset 0 -1px 0 rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    outline: none;
}

/* Borda dourada apenas no foco (mantido) */
.contact-input:focus {
    border-color: var(--gold-color);
    box-shadow: 
        inset 0 2px 4px rgba(0, 0, 0, 0.15),
        inset 0 4px 8px rgba(0, 0, 0, 0.12),
        inset 0 -1px 0 rgba(0, 0, 0, 0.1),
        0 0 0 2px rgba(212, 175, 55, 0.2); /* Mantém o efeito glow */
}

.contact-input::placeholder {
    color: #94a3b8;
    font-style: italic;
    font-size: 11px; /* REDUZIDO para caber melhor nos campos */
}

/* Placeholder piscante com atrasos diferentes para cada campo */
@keyframes blinkPlaceholder {
    0%, 94.9% { opacity: 1; }
    95%, 95.1% { opacity: 0; }
    95.2%, 100% { opacity: 1; }
}

.contact-input:not(:focus):placeholder-shown::placeholder {
    animation: blinkPlaceholder 2.1s infinite;
}

/* Atrasos específicos para cada campo */
#contactName:not(:focus):placeholder-shown::placeholder {
    animation-delay: 0.3s;
}

#contactEmail:not(:focus):placeholder-shown::placeholder {
    animation-delay: 0.6s;
}

#contactPhone:not(:focus):placeholder-shown::placeholder {
    animation-delay: 0.9s;
}

/* Botão com dimensões ajustadas - 5px MAIS PRA CIMA */
.contact-button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 8px 16px;
    background: transparent;
    border: 2px solid var(--gold-color);
    border-radius: 8px;
    color: var(--gold-color);
    font-family: 'Montserrat', sans-serif;
    font-weight: 900;
    font-size: 11px;
    letter-spacing: .08em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.3s ease;
    opacity: 0;
    animation: fadeIn 0.5s ease forwards;
    animation-delay: 1.4s; /* ADICIONADO delay para aparecer após os campos */
    position: relative;
    overflow: hidden;
    min-width: 160px;
    max-width: 200px;
    margin-top: 0px; /* ALTERADO de 5px para 0px (5px mais pra cima) */
    pointer-events: auto; /* Permite interação */
}

.contact-button:hover {
    background: rgba(212, 175, 55, 0.1);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(212, 175, 55, 0.2);
}

.contact-button:active {
    transform: translateY(0);
}

.contact-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.1), transparent);
    transition: left 0.5s ease;
}

.contact-button:hover::before {
    left: 100%;
}

/* Ícone de enviar proporcional ao botão */
.send-icon {
    width: 14px;
    height: 14px;
    fill: var(--gold-color);
    transition: transform 0.3s ease;
}

.contact-button:hover .send-icon {
    transform: translateX(3px);
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Animações para desaparecimento - APENAS FADE OUT SIMPLES */
@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

/* Classes para desaparecimento em ordem - tempo total 0.9s (0.3s cada com delays) */
.fade-out-button {
    animation: fadeOut 0.3s ease forwards !important;
}

.fade-out-fields {
    animation: fadeOut 0.3s ease forwards !important;
    animation-delay: 0.3s !important;
}

.fade-out-text {
    animation: fadeOut 0.3s ease forwards !important;
    animation-delay: 0.6s !important;
}

/* Container unificado para campo de telefone */
.phone-input-container {
    display: flex;
    margin-bottom: 8px;
    width: 100%;
    position: relative;
    border: 2px solid rgba(212, 175, 55, 0.3);
    border-radius: 8px;
    background: white;
    /* Inner shadow mais forte e sempre visível */
    box-shadow: 
        inset 0 2px 4px rgba(0, 0, 0, 0.15),
        inset 0 4px 8px rgba(0, 0, 0, 0.12),
        inset 0 -1px 0 rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    pointer-events: auto; /* Permite interação */
}

.phone-input-container:focus-within {
    border-color: var(--gold-color);
    box-shadow: 
        inset 0 2px 4px rgba(0, 0, 0, 0.15),
        inset 0 4px 8px rgba(0, 0, 0, 0.12),
        inset 0 -1px 0 rgba(0, 0, 0, 0.1),
        0 0 0 2px rgba(212, 175, 55, 0.2); /* Mantém o efeito glow */
}

/* Seletor de país com linha divisória */
.country-flag-container {
    position: relative;
    flex: 0 0 70px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-right: 1px solid rgba(212, 175, 55, 0.3); /* Linha divisória */
}

.country-display {
    display: flex;
    align-items: center;
    gap: 5px;
    pointer-events: none;
}

.flag-icon {
    width: 18px;
    height: 13px;
    border-radius: 2px;
    box-shadow: 0 0 1px rgba(0,0,0,0.3);
}

.country-code-display {
    font-family: 'Montserrat', sans-serif;
    font-size: 13px;
    font-weight: 600;
    color: #020617;
}

/* Select oculto que cobre toda a área */
.country-select {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    opacity: 0.01; /* Quase invisível mas clicável */
    cursor: pointer;
    z-index: 2;
}

/* Campo de telefone com estilo unificado */
.phone-input {
    flex: 1;
    padding: 10px 9px 6px 9px; /* Mesmo padding dos outros campos */
    background: transparent;
    border: none;
    border-radius: 8px;
    font-family: 'Montserrat', sans-serif;
    font-size: 13px;
    color: #020617;
    outline: none;
    box-shadow: none;
}

.phone-input::placeholder {
    color: #94a3b8;
    font-style: italic;
    font-size: 11px; /* REDUZIDO para caber melhor no campo */
}

/* Placeholder piscante para o telefone também */
.phone-input:not(:focus):placeholder-shown::placeholder {
    animation: blinkPlaceholder 2.1s infinite;
    animation-delay: 0.9s;
}

/* ================= FOOTER GRID ================= */
.footer-grid {
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
    display: grid;
    grid-template-columns: 1fr;
    gap: 24px;
}

.footer-grid h4 {
    font-family: 'Montserrat', sans-serif;
    font-weight: 800;
    letter-spacing: .08em;
    text-transform: uppercase;
    margin-bottom: 12px;
    font-size: 0.9rem;
}

.footer-grid p, .footer-grid a {
    font-family: 'Merriweather', serif;
    font-size: 0.9rem;
    color: #cbd5f5;
    text-decoration: none;
    line-height: 1.5;
}

.footer-grid a:hover {
    color: #fff;
    text-decoration: underline;
}

/* ================= ESTILOS PARA LINKS CLICÁVEIS ================= */
a[data-page], a[href$=".html"]:not([href^="http"]):not([href^="#"]):not([href^="mailto"]):not([href^="tel:"]) {
    cursor: pointer;
    transition: opacity 0.3s;
}

a[data-page]:hover, a[href$=".html"]:not([href^="http"]):not([href^="#"]):not([href^="mailto"]):not([href^="tel:"]):hover {
    opacity: 0.8;
}

/* ================= RESPONSIVO ================= */
@media (min-width: 768px) {
    nav {
        position: static;
        display: flex !important;
        flex-direction: row;
        background: none !important;
        animation: none !important;
        padding: 0;
        gap: 24px;
        box-shadow: none;
    }
    
    .menu-toggle {
        display: none;
    }
    
    .footer-grid {
        grid-template-columns: repeat(3, 1fr);
    }
    
    h1 {
        font-size: 2.5rem;
    }
    
    body.blinking header {
        height: 50vh;
    }
    
    body.blinking footer {
        height: 50vh;
    }
    
    .contact-text {
        font-size: 1.7rem; /* Ajustado para desktop */
        margin-bottom: 20px;
    }
    
    .contact-fields-container {
        width: 252px; /* REDUZIDO de 280px para 252px (10% menor) */
    }
    
    .contact-input, .phone-input {
        font-size: 14px;
        padding: 11px 10px 7px 10px; /* Ajustado padding */
    }
    
    .contact-input::placeholder,
    .phone-input::placeholder {
        font-size: 12px; /* Ajustado para desktop */
    }
    
    .country-flag-container {
        flex: 0 0 75px;
    }
    
    .flag-icon {
        width: 20px;
        height: 15px;
    }
    
    .country-code-display {
        font-size: 14px;
    }
    
    .phone-input-container {
        padding-right: 0;
    }
    
    .contact-button {
        font-size: 12px;
        padding: 9px 18px;
        min-width: 180px;
        max-width: 220px;
        margin-top: 0px; /* ALTERADO de 8px para 0px (5px mais pra cima) */
    }
    
    .send-icon {
        width: 15px;
        height: 15px;
    }
}

@media (max-width: 480px) {
    .contact-fields-container {
        width: 202px; /* REDUZIDO de 250px para 225px (10% menor) */
    }
    
    .contact-text {
        font-size: 1.3rem; /* Ajustado para mobile */
        margin-bottom: 12px;
    }
    
    .contact-button {
        min-width: 150px;
        max-width: 190px;
        font-size: 10px;
        padding: 7px 14px;
        margin-top: 0px; /* ALTERADO de 5px para 0px (5px mais pra cima) */
    }
    
    .country-flag-container {
        flex: 0 0 70px;
    }
}

</style>
</head>

<body class="initial-loading">

<header class="gradient-animated">
    <div class="logo">LOGOTIPO</div>
    <div class="menu-toggle">☰</div>
    <nav>
        <a data-page="apps">Apps</a>
        <a data-page="value">Value Offer</a>
        <a data-page="knowledge">Knowledge</a>
        <a data-page="insights">Insights</a>
        <a data-page="contact">Contact</a>
    </nav>
</header>

<main>
    <div id="app">
        <!-- Conteúdo será carregado dinamicamente de arquivos HTML -->
    </div>
</main>

<!-- Overlay de contato (inicialmente oculto) -->
<div class="contact-overlay" id="contactOverlay">
    <div class="contact-text" id="contactText">Build more. Build with REALMETA</div>
    
    <div class="contact-fields-container" id="contactFields">
        <div class="contact-input-container">
            <input type="text" class="contact-input" id="contactName" placeholder="Digite o seu nome..." maxlength="100">
        </div>
        
        <div class="contact-input-container">
            <input type="email" class="contact-input" id="contactEmail" placeholder="Digite o seu e-mail..." maxlength="100">
        </div>
        
        <div class="phone-input-container">
            <div class="country-flag-container">
                <div class="country-display">
                    <span class="flag-icon flag-icon-br" id="countryFlag"></span>
                    <span class="country-code-display" id="countryCodeDisplay">+55</span>
                </div>
                <select id="countryCode" class="country-select">
                    <option value="+55" data-country="br" data-display="+55" data-fullname="Brasil (+55)">Brasil (+55)</option>
                    <option value="+1" data-country="us" data-display="+1" data-fullname="Estados Unidos (+1)">Estados Unidos (+1)</option>
                    <option value="+44" data-country="gb" data-display="+44" data-fullname="Reino Unido (+44)">Reino Unido (+44)</option>
                    <option value="+33" data-country="fr" data-display="+33" data-fullname="França (+33)">França (+33)</option>
                    <option value="+49" data-country="de" data-display="+49" data-fullname="Alemanha (+49)">Alemanha (+49)</option>
                    <option value="+39" data-country="it" data-display="+39" data-fullname="Itália (+39)">Itália (+39)</option>
                    <option value="+34" data-country="es" data-display="+34" data-fullname="Espanha (+34)">Espanha (+34)</option>
                    <option value="+351" data-country="pt" data-display="+351" data-fullname="Portugal (+351)">Portugal (+351)</option>
                    <option value="+54" data-country="ar" data-display="+54" data-fullname="Argentina (+54)">Argentina (+54)</option>
                    <option value="+56" data-country="cl" data-display="+56" data-fullname="Chile (+56)">Chile (+56)</option>
                    <option value="+52" data-country="mx" data-display="+52" data-fullname="México (+52)">México (+52)</option>
                </select>
            </div>
            <input type="tel" class="phone-input" id="contactPhone" placeholder="Digite o seu telefone..." maxlength="20">
        </div>
    </div>
    
    <button class="contact-button" id="contactButton">
        <!-- Ícone SVG de enviar -->
        <svg class="send-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Start a new level
    </button>
</div>

<footer class="gradient-animated">
    <div class="footer-grid">
        <div>
            <h4>Empresa</h4>
            <p>Estruturas digitais orientadas à inteligência e governança.</p>
        </div>
        <div>
            <h4>Contato</h4>
            <a href="mailto:contato@empresa.com">contato@empresa.com</a>
        </div>
        <div>
            <h4>Links</h4>
            <a data-page="compliance">Compliance</a><br>
            <a data-page="privacy">Privacidade</a><br>
            <a data-page="terms">Termos de Uso</a>
        </div>
    </div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Elementos principais
    const body = document.body;
    const header = document.querySelector('header');
    const footer = document.querySelector('footer');
    const menuToggle = document.querySelector('.menu-toggle');
    const nav = document.querySelector('nav');
    const app = document.getElementById('app');
    const contactOverlay = document.getElementById('contactOverlay');
    const contactText = document.getElementById('contactText');
    const contactFields = document.getElementById('contactFields');
    const contactName = document.getElementById('contactName');
    const contactEmail = document.getElementById('contactEmail');
    const contactPhone = document.getElementById('contactPhone');
    const countryCode = document.getElementById('countryCode');
    const countryFlag = document.getElementById('countryFlag');
    const countryCodeDisplay = document.getElementById('countryCodeDisplay');
    const phoneContainer = document.querySelector('.phone-input-container');
    const contactButton = document.getElementById('contactButton');
    
    // Estado da animação
    let isBlinking = false;
    let currentPage = 'apps';
    let areEyelidsClosed = false;
    
    // Cache de conteúdo
    let contentCache = {};
    
    // Mapeamento de páginas para arquivos HTML
    const pageFiles = {
        'apps': 'apps.html',
        'value': 'work.html',
        'knowledge': 'work.html',
        'insights': 'insights.html',
        'compliance': 'work.html',
        'privacy': 'work.html',
        'terms': 'work.html',
        'artigo-inovacao-digital': 'artigo1.html',
        'artigo-natureza-viva': 'artigo2.html',
        'artigo-cidades-inteligentes': 'artigo3.html',
        'artigo-inteligencia-artificial': 'artigo4.html'
    };
    
    // Função para limpar completamente tags de arquivo e conteúdo extra
    function cleanFileTags(html) {
        let cleaned = html.replace(/^[\s\S]*?<div[^>]*>/i, function(match) {
            const divMatch = match.match(/<div[^>]*>/i);
            if (divMatch) {
                return divMatch[0];
            }
            return match;
        });
        
        if (!cleaned.trim().startsWith('<')) {
            cleaned = cleaned.replace(/^[\s\S]*?(<html|<head|<body|<div|<section|<article)/i, '$1');
        }
        
        cleaned = cleaned.replace(/\[file name\]:.*?\n/gi, '');
        cleaned = cleaned.replace(/\[file content begin\]/gi, '');
        cleaned = cleaned.replace(/\[file content end\]/gi, '');
        cleaned = cleaned.replace(/<!DOCTYPE html>.*?<html[^>]*>/gis, '');
        cleaned = cleaned.replace(/<head>.*?<\/head>/gis, '');
        cleaned = cleaned.replace(/<body[^>]*>|<\/body>/gi, '');
        
        return cleaned.trim();
    }
    
    // Função para extrair apenas o conteúdo do body
    function extractBodyContent(html) {
        const bodyMatch = html.match(/<body[^>]*>([\s\S]*?)<\/body>/i);
        if (bodyMatch) {
            return bodyMatch[1].trim();
        }
        
        return cleanFileTags(html);
    }
    
    // ✅ Sincronização para insights.html
    function waitForInsightsGrid() {
        return new Promise((resolve) => {
            if (window.insightsGridReady) {
                console.log('Grid do insights já está pronto');
                resolve();
                return;
            }
            
            console.log('Aguardando grid do insights ficar pronto...');
            
            const onGridReady = () => {
                console.log('Evento insightsGridReady recebido');
                window.removeEventListener('insightsGridReady', onGridReady);
                resolve();
            };
            
            window.addEventListener('insightsGridReady', onGridReady);
            
            setTimeout(() => {
                console.log('Timeout de segurança do grid do insights (150ms)');
                window.removeEventListener('insightsGridReady', onGridReady);
                resolve();
            }, 150);
        });
    }
    
    // ✅ Sincronização para apps.html
    function waitForAppsGrid() {
        return new Promise((resolve) => {
            if (window.appsGridReady) {
                console.log('Grid do apps já está pronto');
                resolve();
                return;
            }
            
            console.log('Aguardando grid do apps ficar pronto...');
            
            const onGridReady = () => {
                console.log('Evento appsGridReady recebido');
                window.removeEventListener('appsGridReady', onGridReady);
                resolve();
            };
            
            window.addEventListener('appsGridReady', onGridReady);
            
            setTimeout(() => {
                console.log('Timeout de segurança do grid do apps (150ms)');
                window.removeEventListener('appsGridReady', onGridReady);
                resolve();
            }, 150);
        });
    }
    
    // Função para executar scripts inline de conteúdo carregado
    function executeScripts(element, pageId) {
        return new Promise((resolve) => {
            console.log(`Executando scripts para: ${pageId}`);
            
            const scripts = element.querySelectorAll('script');
            
            function checkCompletion() {
                console.log('Todos os scripts executados');
                
                if (pageId === 'insights') {
                    waitForInsightsGrid().then(() => {
                        console.log('Grid do insights sincronizado, continuando...');
                        resolve();
                    });
                }
                else if (pageId === 'apps') {
                    waitForAppsGrid().then(() => {
                        console.log('Grid do apps sincronizado, continuando...');
                        resolve();
                    });
                } else {
                    resolve();
                }
            }
            
            if (scripts.length === 0) {
                checkCompletion();
                return;
            }
            
            let scriptsProcessed = 0;
            
            scripts.forEach(oldScript => {
                console.log('Processando script:', oldScript.src || 'inline');
                
                if (oldScript.src) {
                    console.log('Script com src detectado:', oldScript.src);
                    const newScript = document.createElement('script');
                    newScript.src = oldScript.src;
                    
                    if (oldScript.type) newScript.type = oldScript.type;
                    if (oldScript.async) newScript.async = oldScript.async;
                    if (oldScript.defer) newScript.defer = oldScript.defer;
                    
                    newScript.onload = () => {
                        scriptsProcessed++;
                        console.log(`Script carregado: ${oldScript.src} (${scriptsProcessed}/${scripts.length})`);
                        if (scriptsProcessed === scripts.length) {
                            checkCompletion();
                        }
                    };
                    
                    newScript.onerror = (e) => {
                        console.error(`Erro ao carregar script: ${oldScript.src}`, e);
                        scriptsProcessed++;
                        if (scriptsProcessed === scripts.length) {
                            checkCompletion();
                        }
                    };
                    
                    document.head.appendChild(newScript);
                } else {
                    try {
                        const scriptContent = oldScript.textContent;
                        
                        if (!scriptContent || scriptContent.trim() === '') {
                            console.log('Script inline vazio, ignorando');
                            scriptsProcessed++;
                            if (scriptsProcessed === scripts.length) {
                                checkCompletion();
                            }
                            return;
                        }
                        
                        const cleanScript = scriptContent.replace(/\[file name\]:.*?\n/gi, '')
                                                        .replace(/\[file content begin\]/gi, '')
                                                        .replace(/\[file content end\]/gi, '')
                                                        .trim();
                        
                        if (cleanScript) {
                            let finalScript = cleanScript;
                            if (pageId === 'insights' && cleanScript.includes('loadArticles')) {
                                console.log('Otimizando script do insights para execução imediata...');
                                finalScript = finalScript.replace(
                                    /setTimeout\(async \(\) => \{[\s\S]*?loadArticles\(1\)[\s\S]*?\}, 200\);/g,
                                    `// Execução imediata sem delay
                                    (async function() {
                                        await loadArticles(1);
                                        setupInfiniteScroll();
                                        
                                        const gridContainer = document.getElementById('gridContainer');
                                        if (gridContainer) {
                                            gridContainer.style.display = 'grid';
                                            void gridContainer.offsetHeight;
                                        }
                                    })();`
                                );
                            }
                            
                            if (pageId === 'apps' && cleanScript.includes('loadApps')) {
                                console.log('Otimizando script do apps para execução imediata...');
                                finalScript = finalScript.replace(
                                    /setTimeout\(async \(\) => \{[\s\S]*?loadApps\(1\)[\s\S]*?\}, 200\);/g,
                                    `// Execução imediata sem delay
                                    (async function() {
                                        await loadApps(1);
                                        setupInfiniteScroll();
                                        
                                        const gridContainer = document.getElementById('workGridContainer');
                                        if (gridContainer) {
                                            gridContainer.style.display = 'grid';
                                            void gridContainer.offsetHeight;
                                        }
                                    })();`
                                );
                            }
                            
                            const inlineFunction = new Function(finalScript);
                            inlineFunction();
                            
                            console.log('Script inline executado com sucesso');
                        }
                    } catch (error) {
                        console.error('Erro ao executar script inline:', error);
                    } finally {
                        scriptsProcessed++;
                        if (scriptsProcessed === scripts.length) {
                            checkCompletion();
                        }
                    }
                }
            });
            
            setTimeout(() => {
                if (scriptsProcessed < scripts.length) {
                    console.log(`Timeout de segurança ativado. Processados: ${scriptsProcessed}/${scripts.length}`);
                    checkCompletion();
                }
            }, 100);
        });
    }
    
    // Função para aplicar estilos inline
    function applyStyles(element) {
        const styles = element.querySelectorAll('style');
        styles.forEach(style => {
            const newStyle = style.cloneNode(true);
            document.head.appendChild(newStyle);
        });
    }
    
    // Função para carregar conteúdo de um arquivo HTML
    async function loadPageContent(pageId) {
        if (!pageFiles[pageId]) {
            pageId = 'apps';
        }
        
        // Verificar se já temos no cache
        if (contentCache[pageId]) {
            console.log(`Usando conteúdo em cache para: ${pageId}`);
            return contentCache[pageId];
        }
        
        const fileName = pageFiles[pageId];
        
        try {
            const response = await fetch(fileName);
            if (!response.ok) {
                throw new Error(`Erro ao carregar ${fileName}: ${response.status}`);
            }
            
            let html = await response.text();
            
            let cleanHtml = extractBodyContent(html);
            
            if (cleanHtml.includes('[file name]')) {
                cleanHtml = cleanFileTags(cleanHtml);
            }
            
            // Armazenar no cache
            contentCache[pageId] = cleanHtml;
            
            return cleanHtml;
            
        } catch (error) {
            console.error('Erro ao carregar conteúdo:', error);
            throw error;
        }
    }
    
    // Função para inserir conteúdo no app
    async function insertContent(html, pageId) {
        return new Promise((resolve) => {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;
            
            app.innerHTML = '';
            
            let firstChild = tempDiv.firstChild;
            while (firstChild && firstChild.nodeType === 3 && firstChild.textContent.trim() === '') {
                tempDiv.removeChild(firstChild);
                firstChild = tempDiv.firstChild;
            }
            
            if (tempDiv.firstChild) {
                while (tempDiv.firstChild) {
                    app.appendChild(tempDiv.firstChild);
                }
            }
            
            currentPage = pageId;
            
            if (nav.classList.contains('open')) {
                nav.classList.remove('open');
            }
            
            applyStyles(app);
            
            executeScripts(app, pageId).then(() => {
                void app.offsetHeight;
                
                window.dispatchEvent(new CustomEvent('pageLoaded', {
                    detail: { page: pageId }
                }));
                
                resolve();
            });
        });
    }
    
    // ✅ FUNÇÃO PARA FECHAR OVERLAY DE CONTATO COM SIMPLES FADE OUT
    async function closeContactOverlay() {
        return new Promise((resolve) => {
            console.log('Iniciando fade out simples do overlay de contato...');
            
            // Primeiro, animar o botão para desaparecer
            contactButton.classList.add('fade-out-button');
            
            // Depois, animar os campos
            contactFields.classList.add('fade-out-fields');
            
            // Por último, animar o texto
            contactText.classList.add('fade-out-text');
            
            // Aguardar animação completa
            setTimeout(() => {
                console.log('Fade out do overlay concluído');
                resolve();
            }, 900); // Tempo total das animações em cascata
        });
    }
    
    // ✅ FUNÇÃO APENAS PARA FECHAR PÁLPEBRAS (CONTATO) - COM OVERLAY CENTRAL
    async function justCloseEyelids() {
        if (isBlinking) return;
        
        isBlinking = true;
        
        try {
            console.log('Apenas fechando pálpebras para Contact...');
            
            // 1. INICIAR FECHAMENTO DAS PÁLPEBRAS IMEDIATAMENTE
            body.classList.add('blinking');
            void header.offsetHeight;
            
            // 2. AGUARDAR FECHAMENTO COMPLETO (700ms)
            await new Promise(resolve => setTimeout(resolve, 700));
            
            console.log('Pálpebras fechadas completamente - Contact');
            
            // 3. MARCAR PÁLPEBRAS COMO PERMANENTEMENTE FECHADAS
            body.classList.add('eyelids-closed');
            areEyelidsClosed = true;
            
            // 4. FOCO NO PRIMEIRO CAMPO DE INPUT (agora mais rápido)
            setTimeout(() => {
                contactName.focus();
            }, 300); // Reduzido de 1200ms para 300ms
            
            console.log('Pálpebras permanecem fechadas - overlay de contato visível');
            
        } catch (error) {
            console.error('Erro ao fechar pálpebras:', error);
            body.classList.remove('blinking', 'eyelids-closed');
            areEyelidsClosed = false;
        } finally {
            isBlinking = false;
        }
    }
    
    // ✅ FUNÇÃO PARA ABRIR PÁLPEBRAS (quando clicar em outras páginas) - CORRIGIDA
    async function openEyelidsAndLoadPage(pageId) {
        if (isBlinking) return;
        
        isBlinking = true;
        
        try {
            console.log(`Abrindo pálpebras para carregar: ${pageId}`);
            
            // 1. VERIFICAR SE É A MESMA PÁGINA
            if (pageId === currentPage) {
                console.log('Já está na mesma página, ignorando...');
                isBlinking = false;
                return;
            }
            
            // 2. SE ESTIVER NO OVERLAY DE CONTATO, FECHÁ-LO PRIMEIRO
            if (areEyelidsClosed) {
                console.log('Fechando overlay de contato primeiro com fade out simples...');
                
                // IMPORTANTE: Não remover a classe eyelids-closed ainda
                // Primeiro executamos a animação de fade out
                await closeContactOverlay();
                
                // AGORA podemos remover o estado de pálpebras fechadas
                // Mas primeiro, aguardar um frame para garantir que a animação terminou
                await new Promise(resolve => requestAnimationFrame(resolve));
                
                // Remover classes de animação
                contactButton.classList.remove('fade-out-button');
                contactFields.classList.remove('fade-out-fields');
                contactText.classList.remove('fade-out-text');
                
                // Remover estado de pálpebras fechadas
                body.classList.remove('eyelids-closed');
                areEyelidsClosed = false;
                
                // Aguardar um momento para o DOM atualizar
                await new Promise(resolve => setTimeout(resolve, 50));
            }
            
            // 3. INICIAR ANIMAÇÃO DE FECHAMENTO IMEDIATAMENTE
            body.classList.add('blinking');
            void header.offsetHeight;
            
            // 4. AGUARDAR INÍCIO DA ANIMAÇÃO (100ms apenas para garantir que começou)
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // 5. CARREGAR CONTEÚDO ENQUANTO A ANIMAÇÃO CONTINUA
            const loadPromise = loadPageContent(pageId);
            
            // 6. AGUARDAR O RESTO DO TEMPO DE FECHAMENTO (600ms restantes)
            await new Promise(resolve => setTimeout(resolve, 600));
            
            // 7. OCULTAR CONTEÚDO ATUAL E INSERIR NOVO
            body.classList.add('content-hidden');
            
            const newContent = await loadPromise;
            await insertContent(newContent, pageId);
            
            // 8. REMOVER ESTADOS DE ANIMAÇÃO E MOSTRAR NOVO CONTEÚDO
            body.classList.remove('content-hidden', 'blinking');
            body.classList.add('content-visible');
            
            // 9. AGUARDAR ABERTURA DAS PÁLPEBRAS
            await new Promise(resolve => setTimeout(resolve, 700));
            
            body.classList.remove('content-visible');
            
            console.log(`Página ${pageId} carregada com sucesso`);
            
        } catch (error) {
            console.error('Erro durante transição:', error);
            body.classList.remove('blinking', 'content-hidden', 'content-visible', 'eyelids-closed');
            areEyelidsClosed = false;
            
            // Remover classes de animação em caso de erro
            contactButton.classList.remove('fade-out-button');
            contactFields.classList.remove('fade-out-fields');
            contactText.classList.remove('fade-out-text');
            
            setTimeout(() => {
                app.innerHTML = `<div style="max-width:1200px; margin:0 auto; padding:40px 24px;">
                    <h1>Erro de Transição</h1>
                    <p>A página não pôde ser carregada. Tente novamente.</p>
                    <p><small>${error.message}</small></p>
                </div>`;
            }, 100);
        } finally {
            isBlinking = false;
        }
    }
    
    // ✅ FUNÇÃO PRINCIPAL PARA NAVEGAÇÃO
    async function navigateToPage(pageId) {
        if (isBlinking) return;
        
        // Se for Contact, apenas fechar pálpebras e mostrar overlay
        if (pageId === 'contact') {
            await justCloseEyelids();
            return;
        }
        
        // Se já está na mesma página, não fazer nada
        if (pageId === currentPage) {
            console.log(`Já está na página ${pageId}, ignorando...`);
            return;
        }
        
        // Para outras páginas, fazer transição normal
        await openEyelidsAndLoadPage(pageId);
    }
    
    // ✅ FUNÇÕES DE VALIDAÇÃO
    function validateEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }
    
    function validatePhone(phone, countryCode) {
        // Remove todos os caracteres não numéricos
        const cleanPhone = phone.replace(/\D/g, '');
        
        // Validações específicas por país
        if (countryCode === '+55') {
            // Validação para telefone brasileiro: (11) 99999-9999 ou (11) 9999-9999
            return cleanPhone.length >= 10 && cleanPhone.length <= 11;
        } else if (countryCode === '+1') {
            // Validação para EUA/Canadá: 10 dígitos
            return cleanPhone.length === 10;
        } else if (countryCode === '+44') {
            // Validação para Reino Unido: 10-11 dígitos
            return cleanPhone.length >= 10 && cleanPhone.length <= 11;
        }
        
        // Para outros países, aceita entre 8-15 dígitos
        return cleanPhone.length >= 8 && cleanPhone.length <= 15;
    }
    
    // ✅ ATUALIZAR BANDEIRA E CÓDIGO QUANDO O PAÍS É ALTERADO
    function updateCountryDisplay() {
        const selectedOption = countryCode.options[countryCode.selectedIndex];
        const country = selectedOption.getAttribute('data-country');
        const displayCode = selectedOption.getAttribute('data-display');
        
        // Atualizar bandeira
        countryFlag.className = 'flag-icon';
        if (country) {
            countryFlag.classList.add(`flag-icon-${country}`);
        } else {
            countryFlag.classList.add('flag-icon-br');
        }
        
        // Atualizar código de exibição
        countryCodeDisplay.textContent = displayCode || '+55';
    }
    
    // ✅ FUNÇÃO PARA ENVIAR O FORMULÁRIO (botão de contato)
    function handleContactSubmit() {
        const userName = contactName.value.trim();
        const userEmail = contactEmail.value.trim();
        const userPhone = contactPhone.value.trim();
        const selectedCountryCode = countryCode.value;
        
        // Validação básica: nome é obrigatório
        if (!userName) {
            contactName.focus();
            contactName.style.borderColor = '#ef4444';
            contactName.style.boxShadow = 'inset 0 2px 8px rgba(239, 68, 68, 0.2)';
            
            setTimeout(() => {
                contactName.style.borderColor = 'rgba(212, 175, 55, 0.3)';
                contactName.style.boxShadow = 'inset 0 2px 4px rgba(0, 0, 0, 0.15), inset 0 4px 8px rgba(0, 0, 0, 0.12), inset 0 -1px 0 rgba(0, 0, 0, 0.1)';
            }, 1000);
            
            return;
        }
        
        // Validação de e-mail
        if (!validateEmail(userEmail)) {
            contactEmail.focus();
            contactEmail.style.borderColor = '#ef4444';
            contactEmail.style.boxShadow = 'inset 0 2px 8px rgba(239, 68, 68, 0.2)';
            
            setTimeout(() => {
                contactEmail.style.borderColor = 'rgba(212, 175, 55, 0.3)';
                contactEmail.style.boxShadow = 'inset 0 2px 4px rgba(0, 0, 0, 0.15), inset 0 4px 8px rgba(0, 0, 0, 0.12), inset 0 -1px 0 rgba(0, 0, 0, 0.1)';
            }, 1000);
            
            return;
        }
        
        // Validação de telefone
        if (!validatePhone(userPhone, selectedCountryCode)) {
            contactPhone.focus();
            phoneContainer.style.borderColor = '#ef4444';
            phoneContainer.style.boxShadow = 'inset 0 2px 8px rgba(239, 68, 68, 0.2)';
            
            setTimeout(() => {
                phoneContainer.style.borderColor = 'rgba(212, 175, 55, 0.3)';
                phoneContainer.style.boxShadow = 'inset 0 2px 4px rgba(0, 0, 0, 0.15), inset 0 4px 8px rgba(0, 0, 0, 0.12), inset 0 -1px 0 rgba(0, 0, 0, 0.1)';
            }, 1000);
            
            return;
        }
        
        // Formatar telefone para exibição
        const fullPhone = selectedCountryCode + ' ' + userPhone;
        
        console.log(`Dados enviados: Nome: ${userName}, Email: ${userEmail}, Telefone: ${fullPhone}`);
        
        // Efeito visual de envio
        contactButton.disabled = true;
        contactButton.innerHTML = `
            <svg class="send-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                <path d="M8 12L11 15L16 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Enviando...
        `;
        
        // Simular envio
        setTimeout(() => {
            alert(`Obrigado, ${userName}! Em breve entraremos em contato.`);
            
            // Resetar
            contactName.value = '';
            contactEmail.value = '';
            contactPhone.value = '';
            contactButton.disabled = false;
            contactButton.innerHTML = `
                <svg class="send-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Start a new level
            `;
        }, 1500);
    }
    
    // ✅ FUNÇÃO PARA LIMPAR CACHE DE CONTEÚDO
    function clearContentCache() {
        contentCache = {};
        console.log('Cache de conteúdo limpo');
    }
    
    // ✅ EVENT LISTENERS PARA O OVERLAY DE CONTATO
    contactButton.addEventListener('click', handleContactSubmit);
    
    // Atualizar bandeira e código quando o país é alterado
    countryCode.addEventListener('change', updateCountryDisplay);
    
    // Inicializar display da bandeira e código
    updateCountryDisplay();
    
    // Adicionar submit com Enter em qualquer campo
    [contactName, contactEmail, contactPhone].forEach(input => {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleContactSubmit();
            }
        });
    });
    
    // Formatação automática do telefone
    contactPhone.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        
        if (countryCode.value === '+55') {
            // Formato brasileiro: (11) 99999-9999
            if (value.length > 10) {
                value = value.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3');
            } else if (value.length > 6) {
                value = value.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, '($1) $2-$3');
            } else if (value.length > 2) {
                value = value.replace(/^(\d{2})(\d{0,5})/, '($1) $2');
            } else if (value.length > 0) {
                value = value.replace(/^(\d*)/, '($1');
            }
        } else if (countryCode.value === '+1') {
            // Formato americano: (123) 456-7890
            if (value.length > 6) {
                value = value.replace(/^(\d{3})(\d{3})(\d{0,4}).*/, '($1) $2-$3');
            } else if (value.length > 3) {
                value = value.replace(/^(\d{3})(\d{0,3})/, '($1) $2');
            } else if (value.length > 0) {
                value = value.replace(/^(\d*)/, '($1');
            }
        }
        
        e.target.value = value;
    });
    
    // Foco no container de telefone quando clicar em qualquer parte dele
    phoneContainer.addEventListener('click', function(e) {
        if (e.target !== countryCode) {
            contactPhone.focus();
        }
    });
    
    window.blinkAnimation = navigateToPage;
    
    window.addEventListener('triggerBlink', function (e) {
        if (!e.detail || !e.detail.page) return;
        navigateToPage(e.detail.page);
    });
        
    // DELEGAÇÃO DE EVENTOS PARA TODOS OS LINKS DO SITE
    document.addEventListener('click', function(e) {
        const link = e.target.closest('a');
        
        if (!link) return;
        
        const href = link.getAttribute('href');
        const pageId = link.getAttribute('data-page');
        
        if (href && (
            href.startsWith('http') || 
            href.startsWith('mailto:') || 
            href.startsWith('tel:') || 
            href.startsWith('#') ||
            href.includes('://')
        )) {
            return;
        }
        
        e.preventDefault();
        
        if (pageId) {
            navigateToPage(pageId);
            return;
        }
        
        if (href && href.endsWith('.html')) {
            const fileName = href.replace('.html', '');
            if (pageFiles[fileName]) {
                navigateToPage(fileName);
            } else {
                console.warn(`Página não mapeada: ${href}`);
                fetch(href)
                    .then(response => {
                        if (response.ok) {
                            pageFiles[fileName] = href;
                            navigateToPage(fileName);
                        } else {
                            alert('Página não encontrada');
                        }
                    })
                    .catch(() => {
                        alert('Erro ao carregar página');
                    });
            }
            return;
        }
    });
    
    menuToggle.addEventListener('click', function() {
        nav.classList.toggle('open');
    });
    
    document.addEventListener('click', function(e) {
        if (window.innerWidth < 768 && 
            !nav.contains(e.target) && 
            !menuToggle.contains(e.target) && 
            nav.classList.contains('open')) {
            nav.classList.remove('open');
        }
    });
    
    // ✅ EXECUTAR CARREGAMENTO INICIAL
    setTimeout(() => {
        initialLoad();
    }, 100);
    
    // ✅ FUNÇÃO PRINCIPAL MODIFICADA: Carregamento inicial
    async function initialLoad() {
        console.log('Iniciando carregamento inicial com pálpebras já fechadas');
        
        try {
            const content = await loadPageContent('apps');
            await insertContent(content, 'apps');
            
            console.log('Conteúdo inicial 100% carregado e renderizado');
            
            await new Promise(resolve => requestAnimationFrame(resolve));
            
            body.classList.remove('initial-loading');
            body.classList.add('content-visible');
            
            await new Promise(resolve => setTimeout(resolve, 700));
            
            body.classList.remove('content-visible');
            
            console.log('Carregamento inicial completo - pálpebras abertas');
            
        } catch (error) {
            console.error('Erro durante o carregamento inicial:', error);
            body.classList.remove('initial-loading');
            
            app.innerHTML = `<div style="max-width:1200px; margin:0 auto; padding:40px 24px;">
                <h1>Erro de Carregamento</h1>
                <p>A página inicial não pôde ser carregada. Tente novamente.</p>
                <p><small>${error.message}</small></p>
            </div>`;
        }
    }
});
</script>

</body>
</html>