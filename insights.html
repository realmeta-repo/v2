<!-- insights.html - Grid com sombras melhoradas -->
<div style="width:100%; max-width:100%; margin:0 auto; padding:76px 0 40px 0; box-sizing:border-box;">

    <!-- Container do grid -->
    <div id="gridContainer" style="
        max-width: 900px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(3, 280px);
        grid-auto-rows: 380px;
        gap: 30px;
        justify-content: center;
        padding: 0 20px;
    ">
        <!-- Cards serão gerados dinamicamente aqui -->
    </div>

    <!-- Indicadores -->
    <div id="loadingIndicator" style="
        display: none;
        text-align: center;
        padding: 40px;
        color: #666;
        font-family: Tahoma, Arial, sans-serif;
        font-size: .85rem;
        letter-spacing: .08em;
    ">
        Carregando mais artigos...
    </div>

    <div id="noArticles" style="
        display: none;
        text-align: center;
        padding: 80px 20px;
        color: #666;
        font-family: Tahoma, Arial, sans-serif;
        font-size: .95rem;
    ">
        Nenhum artigo encontrado.
    </div>

</div>

<!-- Estilos do carrossel original + adaptações para grid -->
<style>
    /* Estilos do carrossel original mantidos */
    @keyframes pan {
        0%   { transform: translateX(-10%); }
        50%  { transform: translateX(10%); }
        100% { transform: translateX(-10%); }
    }
    
    .card:hover .zoom-layer {
        transform: translateX(-50%) scale(1) !important;
    }
    
    .card-btn:hover {
        background: rgba(255,255,255,.35) !important;
    }
    
    /* Responsividade do grid */
    @media (max-width: 920px) {
        #gridContainer {
            grid-template-columns: repeat(2, 280px) !important;
            gap: 25px !important;
        }
    }
    
    @media (max-width: 620px) {
        #gridContainer {
            grid-template-columns: 280px !important;
            gap: 20px !important;
            padding: 0 10px !important;
        }
    }
    
    /* Card com sombras melhoradas para grid */
    .grid-card {
        flex: 0 0 280px !important;
        height: 380px !important;
        display: block !important;
        text-decoration: none !important;
        color: inherit !important;
        position: relative !important;
        overflow: hidden !important;
        cursor: pointer !important;
        transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
        border-radius: 4px !important;
        
        /* Sombra mais suave para grid */
        box-shadow: 
            0 4px 8px rgba(0, 0, 0, 0.05),
            0 6px 16px rgba(0, 0, 0, 0.05),
            0 12px 24px rgba(0, 0, 0, 0.06) !important;
    }
    
    .grid-card:hover {
        transform: translateY(-6px) scale(1.01) !important;
        
        /* Sombra mais pronunciada no hover */
        box-shadow: 
            0 8px 16px rgba(0, 0, 0, 0.08),
            0 12px 24px rgba(0, 0, 0, 0.08),
            0 20px 40px rgba(0, 0, 0, 0.10) !important;
    }
    
    /* Borda sutil para melhor definição */
    .grid-card::before {
        content: '' !important;
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        border: 1px solid rgba(0, 0, 0, 0.04) !important;
        border-radius: 4px !important;
        pointer-events: none !important;
        z-index: 1 !important;
    }
    
    .grid-card-image-container {
        position: absolute !important;
        inset: 0 !important;
        width: 100% !important;
        height: 100% !important;
        overflow: hidden !important;
        border-radius: 4px !important;
    }
    
    .grid-card-image-layer {
        position: absolute !important;
        inset: 0 !important;
        animation: pan 60s linear infinite !important;
        border-radius: 4px !important;
    }
    
    .grid-card-image {
        position: absolute !important;
        top: 0 !important;
        left: 50% !important;
        width: 150% !important;
        height: 100% !important;
        object-fit: cover !important;
        transform: translateX(-50%) scale(1.33) !important;
        transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
        will-change: transform !important;
        border-radius: 4px !important;
    }
    
    .grid-card:hover .grid-card-image {
        transform: translateX(-50%) scale(1) !important;
    }
    
    .grid-card-overlay {
        position: absolute !important;
        inset: 0 !important;
        display: flex !important;
        flex-direction: column !important;
        justify-content: flex-end !important;
        padding: 22px !important;
        background: linear-gradient(to top,
            rgba(0, 0, 0, 0.85),
            rgba(0, 0, 0, 0.35) 40%,
            transparent 70%) !important;
        color: #fff !important;
        z-index: 2 !important;
        border-radius: 4px !important;
    }
    
    .grid-card-title {
        font-family: Montserrat, sans-serif !important;
        font-weight: 800 !important;
        text-transform: uppercase !important;
        letter-spacing: .06em !important;
        font-size: 1rem !important;
        margin: 0 0 10px 0 !important;
        line-height: 1.25 !important;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3) !important;
    }
    
    .grid-card-description {
        font-family: Tahoma, Arial, sans-serif !important;
        line-height: 1.45 !important;
        font-size: 0.82rem !important;
        margin: 0 0 18px 0 !important;
        opacity: 0.92 !important;
        display: -webkit-box !important;
        -webkit-line-clamp: 2 !important;
        -webkit-box-orient: vertical !important;
        overflow: hidden !important;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
    }
    
    .grid-card-footer {
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        width: 100% !important;
    }
    
    .grid-card-tags {
        font-size: .65rem !important;
        opacity: .75 !important;
        font-family: Tahoma, Arial, sans-serif !important;
        display: -webkit-box !important;
        -webkit-line-clamp: 1 !important;
        -webkit-box-orient: vertical !important;
        overflow: hidden !important;
        flex: 1 !important;
        margin-right: 10px !important;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
    }
    
    .grid-card-btn {
        background: rgba(255, 255, 255, 0.15) !important;
        border: 1px solid rgba(255, 255, 255, 0.25) !important;
        padding: 6px 16px !important;
        border-radius: 999px !important;
        font-size: .7rem !important;
        font-family: Tahoma, Arial, sans-serif !important;
        white-space: nowrap !important;
        transition: all 0.3s ease !important;
        backdrop-filter: blur(4px) !important;
        -webkit-backdrop-filter: blur(4px) !important;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
    }
    
    .grid-card:hover .grid-card-btn {
        background: rgba(255, 255, 255, 0.25) !important;
        border-color: rgba(255, 255, 255, 0.35) !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15) !important;
    }
    
    /* Melhoria de contraste para melhor legibilidade */
    .grid-card-overlay::before {
        content: '' !important;
        position: absolute !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        height: 80% !important;
        background: linear-gradient(to top,
            rgba(0, 0, 0, 0.7) 0%,
            rgba(0, 0, 0, 0.4) 60%,
            transparent 100%) !important;
        z-index: -1 !important;
        border-radius: 4px !important;
    }
    
    /* Redução de motion para acessibilidade */
    @media (prefers-reduced-motion: reduce) {
        .grid-card-image-layer {
            animation: none !important;
        }
        
        .grid-card-image {
            transition: none !important;
        }
        
        .grid-card {
            transition: none !important;
        }
        
        .grid-card-btn {
            transition: none !important;
        }
    }
    
    /* Melhoria de foco para acessibilidade */
    .grid-card:focus {
        outline: 2px solid rgba(0, 123, 255, 0.5) !important;
        outline-offset: 2px !important;
    }
</style>

<script>
// IIFE para evitar conflitos
(function() {
    'use strict';
    
    // Configurações
    const ARTICLES_PER_PAGE = 9;
    let currentPage = 1;
    let isLoading = false;
    let allArticles = [];
    
    // Mapeamento de artigos existentes
    const articleFiles = {
        'ia-armadilha': 'insights/armadilha-ia.html'
    };
    
    // Aguardar DOM
    function waitForDOM() {
        return new Promise(resolve => {
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', resolve);
            } else {
                setTimeout(resolve, 100);
            }
        });
    }
    
    // Extrair metadados do artigo
    async function extractArticleMetadata(fileName) {
        try {
            console.log('Carregando artigo:', fileName);
            const response = await fetch(fileName);
            if (!response.ok) {
                console.warn('Artigo não encontrado:', fileName);
                return null;
            }
            
            const html = await response.text();
            const tempDiv = document.createElement('div');
            
            // Limpar tags de arquivo
            const cleanHtml = html.replace(/\[file name\]:.*?\n/gi, '')
                                  .replace(/\[file content begin\]/gi, '')
                                  .replace(/\[file content end\]/gi, '')
                                  .trim();
            
            tempDiv.innerHTML = cleanHtml;
            
            // Extrair título do banner
            const titleElement = tempDiv.querySelector('.article-banner h1');
            const title = titleElement ? titleElement.textContent.trim() : 'Artigo sem título';
            
            // Extrair descrição do banner
            const descElement = tempDiv.querySelector('.article-banner p');
            const description = descElement ? descElement.textContent.trim() : '';
            
            // Extrair imagem do banner
            const imgElement = tempDiv.querySelector('.article-banner img');
            const imageUrl = imgElement ? imgElement.src : 
                'https://images.unsplash.com/photo-1677442136019-21780ecad995?auto=format&fit=crop&w=560&q=80';
            
            // Extrair hashtags (máximo 3)
            const tagElements = tempDiv.querySelectorAll('.hashtags-component .article-tags span');
            let tags = [];
            if (tagElements.length > 0) {
                tags = Array.from(tagElements).slice(0, 3).map(span => 
                    span.textContent.trim().replace('#', '')
                ).filter(tag => tag.length > 0);
            }
            
            // Determinar data-page
            const dataPage = Object.keys(articleFiles).find(key => articleFiles[key] === fileName) || 
                           fileName.replace('.html', '');
            
            return {
                dataPage,
                title: title.substring(0, 80),
                description: description.substring(0, 120),
                imageUrl,
                tags: tags.slice(0, 3),
                fileName
            };
            
        } catch (error) {
            console.error('Erro ao processar artigo:', fileName, error);
            return null;
        }
    }
    
    // Criar card com sombras melhoradas
    function createArticleCard(article) {
        const card = document.createElement('a');
        card.className = 'grid-card';
        card.setAttribute('data-page', article.dataPage);
        
        // Formatar tags para exibição
        const tagsText = article.tags.length > 0 ? 
            article.tags.map(tag => `#${tag}`).join(' ') : 
            '#artigo';
        
        card.innerHTML = `
            <div class="grid-card-image-container">
                <div class="grid-card-image-layer">
                    <img src="${article.imageUrl}" alt="${article.title}" 
                         class="grid-card-image">
                </div>
                <div class="grid-card-overlay">
                    <h3 class="grid-card-title">
                        ${article.title}
                    </h3>
                    <p class="grid-card-description">
                        ${article.description}
                    </p>
                    <div class="grid-card-footer">
                        <div class="grid-card-tags">
                            ${tagsText}
                        </div>
                        <span class="grid-card-btn">
                            Ler artigo
                        </span>
                    </div>
                </div>
            </div>
        `;
        
        // Evento de clique para abrir artigo
        card.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            // Usar a função do app shell ou fallback
            if (typeof window.blinkAnimation === 'function') {
                window.blinkAnimation(article.dataPage);
            } else {
                // Tentar usar o sistema de navegação do app shell
                const event = new CustomEvent('triggerBlink', {
                    detail: { page: article.dataPage },
                    bubbles: true
                });
                window.dispatchEvent(event);
            }
        });
        
        return card;
    }
    
    // Carregar artigos paginados
    async function loadArticles(page = 1) {
        if (isLoading) return;
        
        isLoading = true;
        const loadingIndicator = document.getElementById('loadingIndicator');
        const noArticles = document.getElementById('noArticles');
        const gridContainer = document.getElementById('gridContainer');
        
        if (loadingIndicator) loadingIndicator.style.display = 'block';
        
        try {
            // Primeira página: carregar todos os artigos
            if (page === 1) {
                allArticles = [];
                gridContainer.innerHTML = '';
                
                // Carregar metadados de cada artigo
                const promises = Object.values(articleFiles).map(fileName => 
                    extractArticleMetadata(fileName)
                );
                
                const results = await Promise.all(promises);
                allArticles = results.filter(article => article !== null);
                
                // Ordenar alfabeticamente por título
                allArticles.sort((a, b) => a.title.localeCompare(b.title));
                
                // Mostrar mensagem se não houver artigos
                if (allArticles.length === 0) {
                    if (noArticles) noArticles.style.display = 'block';
                    if (gridContainer) gridContainer.style.display = 'none';
                    return;
                } else {
                    if (noArticles) noArticles.style.display = 'none';
                    if (gridContainer) gridContainer.style.display = 'grid';
                }
            }
            
            // Calcular índices para paginação
            const startIndex = (page - 1) * ARTICLES_PER_PAGE;
            const endIndex = startIndex + ARTICLES_PER_PAGE;
            const articlesToShow = allArticles.slice(startIndex, endIndex);
            
            // Adicionar cards ao grid
            articlesToShow.forEach(article => {
                const card = createArticleCard(article);
                gridContainer.appendChild(card);
            });
            
            currentPage = page;
            console.log(`Carregados ${articlesToShow.length} artigos (página ${page})`);
            
            // Esconder indicador se não há mais artigos
            if (endIndex >= allArticles.length && loadingIndicator) {
                loadingIndicator.style.display = 'none';
            }
            
        } catch (error) {
            console.error('Erro ao carregar artigos:', error);
            if (noArticles) {
                noArticles.textContent = 'Erro ao carregar artigos. Recarregue a página.';
                noArticles.style.display = 'block';
            }
        } finally {
            isLoading = false;
            if (loadingIndicator) loadingIndicator.style.display = 'none';
        }
    }
    
    // Configurar infinite scroll
    function setupInfiniteScroll() {
        let scrollTimeout;
        
        function checkScroll() {
            if (isLoading) return;
            
            const scrollPosition = window.innerHeight + window.scrollY;
            const pageEnd = document.body.offsetHeight - 300;
            
            if (scrollPosition >= pageEnd) {
                const totalLoaded = currentPage * ARTICLES_PER_PAGE;
                if (totalLoaded < allArticles.length) {
                    loadArticles(currentPage + 1);
                }
            }
        }
        
        window.addEventListener('scroll', function() {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(checkScroll, 100);
        });
    }
    
    // Inicializar
    async function init() {
        await waitForDOM();
        console.log('Inicializando grid de insights...');
        
        // Aguardar um pouco para garantir que tudo esteja carregado
        setTimeout(async () => {
            await loadArticles(1);
            setupInfiniteScroll();
            
            // Forçar layout do grid
            const gridContainer = document.getElementById('gridContainer');
            if (gridContainer) {
                gridContainer.style.display = 'grid';
            }
        }, 200);
    }
    
    // Iniciar
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
    
    // Expor função para adicionar artigos dinamicamente
    window.addInsightsArticle = function(fileName, dataPage) {
        if (!articleFiles[dataPage]) {
            articleFiles[dataPage] = fileName;
            
            // Recarregar artigos se estiver na primeira página
            if (currentPage === 1 && allArticles.length < ARTICLES_PER_PAGE) {
                loadArticles(1);
            }
        }
    };
    
})();
</script>